# Security Analysis: CVE-2025-69872 (diskcache)

## Executive Summary

**Status**: âœ… **NOT EXPLOITABLE** in mcp-atlassian
**Risk Level**: **LOW** (vulnerable dependency present but unused)
**Action Required**: **Monitor for upstream fix**, no immediate changes needed

---

## Vulnerability Details

### CVE-2025-69872: DiskCache Unsafe Pickle Deserialization

- **Package**: `diskcache` v5.6.3
- **Severity**: **MEDIUM** (CVSS 4.0: 5.2)
- **Type**: Arbitrary code execution via insecure pickle deserialization (CWE-94, CWE-502)
- **Published**: 2026-02-11
- **Patched Version**: **None available yet**

### Attack Requirements

1. **Local filesystem access**: Attacker needs write access to the cache directory
2. **Application reads from cache**: Victim application must call `cache.get()` on poisoned data

### Realistic Scenarios

- Misconfigured permissions (world-writable `/tmp` cache)
- Shared container volumes (multi-pod environments)
- Compromised filesystem access

---

## Dependency Analysis

### How diskcache Entered the Project

```
mcp-atlassian (this project)
â””â”€â”€ fastmcp>=2.13.0
    â””â”€â”€ py-key-value-aio[disk, keyring, memory] v0.3.0
        â””â”€â”€ diskcache v5.6.3 (via [disk] extra)
```

**Classification**: **Transitive dependency**
**Direct dependency**: `fastmcp>=2.13.0,<2.15.0` (specified in pyproject.toml:13)

### fastmcp's Use of diskcache

From [fastmcp documentation](https://gofastmcp.com/servers/storage-backends):

> **Disk caching is OPT-IN**, not default. FastMCP uses in-memory storage by default.

To enable disk caching, applications must explicitly:

1. Import `DiskStore` from `py-key-value-aio`
2. Pass `DiskStore(directory="path")` to middleware
3. Configure `ResponseCachingMiddleware(cache_storage=DiskStore(...))`

### mcp-atlassian's Usage

**Codebase search results**:

```bash
# No usage found in source code
grep -r "DiskStore\|cache_storage\|ResponseCaching" src/
# Result: No matches

grep -r "diskcache\|py-key-value" src/
# Result: No matches
```

**Conclusion**: mcp-atlassian **does not use** disk caching features. The `diskcache` package is installed but never imported or executed.

---

## Exploitability Assessment

### Is mcp-atlassian Vulnerable?

âŒ **NO** - The vulnerability is **not exploitable** in this project because:

1. **diskcache is never instantiated**
   - No `DiskStore` imports in codebase
   - No cache directory configuration
   - Default behavior is in-memory caching only

2. **No filesystem cache operations**
   - The application never calls `diskcache.Cache()` or related APIs
   - No code path leads to pickle deserialization from disk

3. **Attack vector unavailable**
   - Even if an attacker had write access to the container filesystem
   - There is no cache directory for them to poison
   - The vulnerable code path (`pickle.load()`) is never executed

### Docker Deployment Context

Our MCPB extension (see `eruditis-atlassian-mcpb/server/index.js`) runs mcp-atlassian in a hardened Docker container:

```javascript
"--read-only",              // Read-only root filesystem
"--tmpfs", "/tmp:noexec,nosuid,size=64m",  // Writable tmp with restrictions
"--cap-drop=ALL",           // No Linux capabilities
"--security-opt", "no-new-privileges:true",
```

**Additional isolation**: Even if disk caching were enabled:
- Container filesystem is ephemeral (removed on exit)
- No volume mounts (no persistent storage)
- Read-only root filesystem (only `/tmp` is writable)
- Attacker would need to compromise the container AND write to `/tmp` AND the app would need to use disk caching (which it doesn't)

---

## Risk Analysis

### CVSS 4.0 Breakdown

- **Attack Vector**: Local (AV:L) - requires local filesystem access
- **Attack Complexity**: Low (AC:L) - straightforward pickle injection
- **Attack Requirements**: None (AT:N)
- **Privileges Required**: Low (PR:L) - needs write access to cache directory
- **User Interaction**: Active (UI:A) - victim must read from cache
- **Confidentiality/Integrity/Availability Impact**: High (VC:H/VI:H/VA:H)

**Score**: 5.2 (MEDIUM)

### Adjusted Risk for mcp-atlassian

| Factor | Standard Risk | Actual Risk | Reason |
|--------|---------------|-------------|--------|
| **Presence** | âœ… Installed | âœ… Installed | In dependency tree |
| **Execution** | âš ï¸ May execute | âŒ Never executes | Code never imports/uses |
| **Exposure** | âš ï¸ Cache writable | âŒ No cache exists | No disk caching configured |
| **Impact** | ðŸ”´ RCE | âœ… None | Vulnerable code path unreachable |

**Effective Risk**: **LOW** (dependency present but unused)

---

## Recommended Actions

### Immediate (Now)

âœ… **No action required** - The vulnerability does not affect this project.

**Rationale**:
- Vulnerable code is not executed
- Attack vector is unavailable
- Changing dependencies would create unnecessary churn
- Risk is theoretical, not practical

### Short-term (Monitor)

1. **Watch for upstream fix**
   Subscribe to:
   - https://github.com/grantjenks/python-diskcache/security/advisories
   - Dependabot alerts for this repo

2. **Update when patched version is released**
   ```bash
   # When diskcache > 5.6.3 is available:
   uv lock --upgrade-package diskcache
   uv sync
   # Test and deploy
   ```

### Long-term (Best Practices)

1. **Dependency hygiene**
   - Review transitive dependencies periodically
   - Consider using `uv tree` to audit dependency chains
   - Remove unused extras from dependencies when possible

2. **Principle of least privilege**
   - If disk caching is ever needed, use JSON serialization:
     ```python
     from diskcache import Cache, JSONDisk
     cache = Cache('/path', disk=JSONDisk)  # Safe
     ```
   - Set strict cache directory permissions: `chmod 700`

3. **Container hardening** (already implemented)
   - Read-only filesystem âœ…
   - No volume mounts âœ…
   - Capability dropping âœ…

---

## Why NOT to Remove diskcache

### Option 1: Remove [disk] extra from fastmcp dependency

```diff
-"fastmcp>=2.13.0,<2.15.0",
+"fastmcp[memory,keyring]>=2.13.0,<2.15.0",
```

**Problems**:
1. **Breaking changes risk**: Upstream may assume [disk] is available
2. **Maintenance burden**: Must track fastmcp's optional dependency requirements
3. **False security**: Doesn't eliminate risk, just moves it
4. **Complexity**: Requires testing to ensure no hidden dependencies

### Option 2: Pin diskcache to non-existent "patched" version

Not possible - no patched version exists yet.

### Option 3: Do nothing (RECOMMENDED)

**Why this is correct**:
- âœ… Follows "don't fix what isn't broken" principle
- âœ… Avoids unnecessary code changes
- âœ… Maintains compatibility with upstream
- âœ… Reduces maintenance burden
- âœ… Risk is theoretical only

**When to act**: When diskcache releases a patched version, update via normal dependency update process.

---

## Testing Verification

To verify diskcache is not used:

```bash
# 1. Check imports in source
rg "from.*diskcache|import.*diskcache" src/
# Expected: No matches

# 2. Check DiskStore usage
rg "DiskStore|cache_storage" src/
# Expected: No matches

# 3. Runtime verification (if needed)
# Start mcp-atlassian with MCP_VERBOSE=true
# Confirm no cache directory creation
# Confirm no pickle operations in logs
```

---

## References

- **CVE Details**: https://nvd.nist.gov/vuln/detail/CVE-2025-69872
- **GitHub Advisory**: https://github.com/advisories/GHSA-w8v5-vhqr-4h9v
- **Disclosure**: https://github.com/EthanKim88/ethan-cve-disclosures/blob/main/CVE-2025-69872-DiskCache-Pickle-Deserialization.md
- **fastmcp Storage Docs**: https://gofastmcp.com/servers/storage-backends
- **Dependabot Alert**: https://github.com/Troubladore/mcp-atlassian/security/dependabot/10

---

## Conclusion

CVE-2025-69872 is a **theoretical risk** for mcp-atlassian. The vulnerable code is present in the dependency tree but is never executed. No remediation is needed beyond monitoring for an upstream patch.

This is a textbook example of why **CVSS scores must be contextualized**. A MEDIUM severity vulnerability in a library can be LOW or zero risk in a specific application, depending on usage patterns.

**Status**: Safe to deploy as-is. Update when patch is available.

---

**Analysis Date**: 2026-02-15
**Analyst**: Claude Code (Opus 4.6)
**Reviewed**: mcp-atlassian fork by Troubladore
